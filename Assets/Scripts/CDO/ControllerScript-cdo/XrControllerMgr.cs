using Photon.Pun;
using UnityEngine;
using UnityEngine.InputSystem;
using UnityEngine.XR.Interaction.Toolkit;

public class XrControllerMgr : MonoBehaviourPunCallbacks
{
    [SerializeField] GameObject optionPanel;
    //아이템총 인풋액션(인풋 프라이머리)
    [SerializeField] InputActionReference AInputActionReference;
    [SerializeField] InputActionReference MenuInputActionReference;

    [SerializeField] ActionBasedController rightController;

    //게임오브젝트 활성화 비활성화용
    [Header("각 스크립트 들어가있는 오브젝트")]
    [SerializeField] GameObject handHarvestObj;
    [SerializeField] GameObject ItemObj;
    [SerializeField] ItemInputB itemInputB;

    [Header("총 프리팹 (모델)")]
    [SerializeField] GameObject harvestGun;
    [SerializeField] GameObject ItemGun;

    private bool isOption = false;
    bool isItemController = false;   //처음은 채집총 시작
    GameObject RController;
    Transform lasetRcontroller; //temp

    private void Start()
    {
        RController = Instantiate(ItemGun, rightController.gameObject.transform);
        RController.SetActive(false);

        optionPanel.SetActive(false);
    }

    public override void OnEnable()
    {
        base.OnEnable();
        AInputActionReference.action.Enable();
        AInputActionReference.action.performed += ControllerA;

        MenuInputActionReference.action.Enable();
        MenuInputActionReference.action.performed += ControllerMenu;

    }

    public override void OnDisable()
    {
        base.OnDisable();
        AInputActionReference.action.performed -= ControllerA;
        AInputActionReference.action.Disable();

        MenuInputActionReference.action.performed -= ControllerMenu;
        MenuInputActionReference.action.Disable();

    }

    //종현 , 메뉴 버튼 클릭시 옵션 창
    private void ControllerMenu(InputAction.CallbackContext context)
    {
        if(photonView.IsMine)
        {
            isOption = !isOption;
            if(isOption)
            {
                optionPanel.SetActive(true);
            }
            else
            {
                optionPanel.SetActive(false);
            }
        }
    }

    //아이템, 채집총 교체 a
    private void ControllerA(InputAction.CallbackContext context)
    {
        if (photonView.IsMine)
        {

            if (isItemController == false)
            {
                Debug.Log("컨트롤 a버튼 채집총 > 아이템총 교체");

                isItemController = true;
                IsItemObj(true);
                itemInputB.StateItem(true);
            }
            else if (isItemController == true)
            {
                Debug.Log("컨트롤 a버튼 아이템총 > 채집총 교체");

                isItemController = false;
                itemInputB.StateItem(false);
                IsItemObj(false);
            }
        }

    }

    public void IsItemObj(bool isItem)
    {
        ItemObj.SetActive(isItem);
        handHarvestObj.SetActive(!isItem);
        if (isItem == true)
        {
            lasetRcontroller = rightController.model;
            rightController.model.gameObject.SetActive(false);
            RController.SetActive(true);
            rightController.model = RController.transform;
            rightController.modelPrefab = RController.transform;
        }
        else if (isItem == false)
        {
            rightController.model = lasetRcontroller;
            rightController.model.gameObject.SetActive(true);
            RController.SetActive(false);
            rightController.model = lasetRcontroller;
            rightController.modelPrefab = lasetRcontroller;

        }

    }








}
